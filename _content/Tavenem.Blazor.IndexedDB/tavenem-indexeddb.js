var D=(e,t)=>t.some(r=>e instanceof r),b,p;function M(){return b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function I(){return p||(p=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var w=new WeakMap,m=new WeakMap,y=new WeakMap;function L(e){let t=new Promise((r,n)=>{let o=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{r(u(e.result)),o()},s=()=>{n(e.error),o()};e.addEventListener("success",i),e.addEventListener("error",s)});return y.set(t,e),t}function O(e){if(w.has(e))return;let t=new Promise((r,n)=>{let o=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{r(),o()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});w.set(e,t)}var N={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return w.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return u(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function C(e){N=e(N)}function j(e){return I().includes(e)?function(...t){return e.apply(g(this),t),u(this.request)}:function(...t){return u(e.apply(g(this),t))}}function A(e){return typeof e=="function"?j(e):(e instanceof IDBTransaction&&O(e),D(e,M())?new Proxy(e,N):e)}function u(e){if(e instanceof IDBRequest)return L(e);if(m.has(e))return m.get(e);let t=A(e);return t!==e&&(m.set(e,t),y.set(t,e)),t}var g=e=>y.get(e);function E(e,t,{blocked:r,upgrade:n,blocking:o,terminated:i}={}){let s=indexedDB.open(e,t),f=u(s);return n&&s.addEventListener("upgradeneeded",c=>{n(u(s.result),c.oldVersion,c.newVersion,u(s.transaction),c)}),r&&s.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),f.then(c=>{i&&c.addEventListener("close",()=>i()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),f}function V(e,{blocked:t}={}){let r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",n=>t(n.oldVersion,n)),u(r).then(()=>{})}var k=["get","getKey","getAll","getAllKeys","count"],K=["put","add","delete","clear"],h=new Map;function P(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(h.get(t))return h.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,o=K.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||k.includes(r)))return;let i=async function(s,...f){let c=this.transaction(s,o?"readwrite":"readonly"),l=c.store;return n&&(l=l.index(f.shift())),(await Promise.all([l[r](...f),o&&c.done]))[0]};return h.set(t,i),i}C(e=>({...e,get:(t,r,n)=>P(t,r)||e.get(t,r,n),has:(t,r)=>!!P(t,r)||e.has(t,r)}));var T=["continue","continuePrimaryKey","advance"],x={},B=new WeakMap,v=new WeakMap,W={get(e,t){if(!T.includes(t))return e[t];let r=x[t];return r||(r=x[t]=function(...n){B.set(this,v.get(this)[t](...n))}),r}};async function*F(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;let r=new Proxy(t,W);for(v.set(r,t),y.set(r,g(t));t;)yield r,t=await(B.get(r)||t.continue()),B.delete(r)}function S(e,t){return t===Symbol.asyncIterator&&D(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&D(e,[IDBIndex,IDBObjectStore])}C(e=>({...e,get(t,r,n){return S(t,r)?F:e.get(t,r,n)},has(t,r){return S(t,r)||e.has(t,r)}}));var d={};async function a(e){e.version===null&&(e.version=void 0),e.keyPath??="id";try{return await E(e.databaseName,e.version,{upgrade(r){if(e.storeNames)for(let n of e.storeNames)r.objectStoreNames.contains(n)||r.createObjectStore(n,{keyPath:e.keyPath});r.objectStoreNames.length==0&&!r.objectStoreNames.contains(e.databaseName)&&r.createObjectStore(e.databaseName,{keyPath:e.keyPath})}})}catch(t){return console.error(t),null}}async function z(e){let t=await a(e);if(t)try{return await t.clear(e.storeName??e.databaseName)}catch(r){console.error(r)}}async function G(e){let t=await a(e);if(!t)return 0;try{return await t.count(e.storeName??e.databaseName)}catch(r){return console.error(r),0}}async function H(e){try{await V(e)}catch(t){console.error(t)}}async function Q(e,t){let r=await a(e);if(!r)return!1;try{return await r.delete(e.storeName??e.databaseName,t),!0}catch(n){return console.error(n),!1}}async function U(e){let t=await a(e);if(!t)return[];try{return await t.getAll(e.storeName??e.databaseName)}catch(r){return console.error(r),[]}}async function X(e){let t=await a(e);if(!t)return[];try{var r=await t.getAll(e.storeName??e.databaseName);return r.map(n=>JSON.stringify(n))}catch(n){return console.error(n),[]}}async function Y(e,t){let r=await a(e);if(!r)return[];let n=e.databaseName+"."+e.storeName;t&&delete d[n];let o=d[n];if(!o||o.db.version!=e.version)try{let s=await r.transaction(e.storeName??e.databaseName).store.openCursor();o={db:e,cursor:s}}catch(s){console.error(s)}if(!o)return[];let i=[];try{for(;o.cursor&&i.length<20;)i.push(o.cursor.value),o.cursor=await o.cursor.continue()}catch(s){console.error(s)}return d[n]=o,i}async function Z(e,t){let r=await a(e);if(!r)return[];let n=e.databaseName+"."+e.storeName;t&&delete d[n];let o=d[n];if(!o||o.db.version!=e.version)try{let s=await r.transaction(e.storeName??e.databaseName).store.openCursor();o={db:e,cursor:s}}catch(s){console.error(s)}if(!o)return[];let i=[];try{for(;o.cursor&&i.length<20;)i.push(JSON.stringify(o.cursor.value)),o.cursor=await o.cursor.continue()}catch(s){console.error(s)}return d[n]=o,i}async function _(e,t){let r=await a(e);if(!r)return null;try{return await r.get(e.storeName??e.databaseName,t)}catch(n){return console.error(n),null}}async function q(e,t){let r=await a(e);if(!r)return null;try{return JSON.stringify(await r.get(e.storeName??e.databaseName,t))}catch(n){return console.error(n),null}}async function ee(e,t){let r=await a(e);if(!r)return!1;try{return await r.put(e.storeName??e.databaseName,JSON.parse(t)),!0}catch(n){return console.error(n),!1}}export{z as clear,G as count,H as deleteDatabase,Q as deleteValue,U as getAll,X as getAllStrings,Y as getBatch,Z as getBatchStrings,_ as getValue,q as getValueString,ee as putValue};
//# sourceMappingURL=tavenem-indexeddb.js.map
